<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CR 4.0 - ç°ä»£åŒ–ç³»ç»Ÿç¼–ç¨‹è¯­è¨€</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    <style>
        :root {
            --primary: #2baeff;
            --accent: #00ff88;
            --dark-bg: #1a1a1a;
            --code-bg: #2d2d2d;
            --text: #e0e0e0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text);
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        /* æ”¹è¿›çš„å¯¼èˆªæ  */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.95);
            padding: 1rem;
            backdrop-filter: blur(12px);
            z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-links a {
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            white-space: nowrap;
        }

        .nav-links a:hover {
            background: rgba(43, 174, 255, 0.15);
            transform: translateY(-2px);
        }

        /* å¢å¼ºçš„ä¸»å†…å®¹åŒº */
        .hero {
            padding: 12rem 2rem 6rem;
            text-align: center;
            background: linear-gradient(45deg, #0a0a0a 30%, #1a1a1a 100%);
        }

        .hero h1 {
            font-size: clamp(2.5rem, 6vw, 4rem);
            margin-bottom: 1.5rem;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
        }

        .section {
            max-width: 1300px;
            margin: 4rem auto;
            padding: 2rem;
        }

        /* å“åº”å¼ç‰¹æ€§ç½‘æ ¼ */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 400px), 1fr));
            gap: 2rem;
            padding: 2rem 0;
        }

        /* å¢å¼ºçš„ä»£ç å—æ ·å¼ */
        .code-block {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            font-family: 'Fira Code', monospace;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .code-block::-webkit-scrollbar {
            height: 8px;
            background: rgba(0,0,0,0.2);
        }

        .code-block::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        /* åŠ¨æ€ç‰¹æ€§å¡ç‰‡ */
        .feature-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 2rem;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        /* æ–°å¢ç‰¹æ€§æ ‡ç­¾ */
        .feature-tag {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            background: rgba(43, 174, 255, 0.15);
            color: var(--primary);
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .hero {
                padding: 8rem 1rem 4rem;
            }
            
            .nav-links {
                gap: 0.8rem;
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 0.5rem;
            }
            
            .feature-card {
                padding: 1.5rem;
            }
        }
    </style>
</head><body>
    <!-- å¯¼èˆªæ æ–°å¢è¯­æ³•åŸºç¡€éƒ¨åˆ† -->
    <nav class="navbar">
        <div class="nav-links">
            <a href="#basic">åŸºç¡€è¯­æ³•</a>
            <a href="#memory">å†…å­˜æ¨¡å‹</a>
            <a href="#concurrency">å¹¶å‘æ¨¡å‹</a>
            <a href="#syntax">é«˜çº§è¯­æ³•</a>
            <a href="#system">ç³»ç»Ÿç¼–ç¨‹</a>
        </div>
    </nav>

    <!-- åŸºç¡€è¯­æ³•éƒ¨åˆ† -->
    <section id="basic" class="section">
        <h2>ğŸ“– åŸºç¡€è¯­æ³•</h2>

        <div class="feature-card">
            <h3>å®‰å…¨åŸŸï¼ˆSafe/Legacy Blocksï¼‰</h3>
            <div class="code-block">
                <pre><code class="language-cpp">// é»˜è®¤ä»£ç å¤„äºlegacyæ¨¡å¼ï¼ˆå…¼å®¹C++ï¼‰
int* raw = new int(42);  // ä¼ ç»ŸæŒ‡é’ˆ

<span class="code-comment">// æ˜¾å¼å®‰å…¨åŸŸï¼ˆå¯ç”¨å†…å­˜å®‰å…¨æ£€æŸ¥ï¼‰</span>
safe {
    <span class="code-keyword">own</span>&lt;int&gt; sp = own_new&lt;int&gt;(100);  // å®‰å…¨æŒ‡é’ˆ
    <span class="code-keyword">borrow</span>&lt;int&gt; br = *sp;           // å€Ÿç”¨æ£€æŸ¥
    
    <span class="code-comment">// è·¨åŸŸäº¤äº’éœ€è¦æ˜¾å¼æ ‡è®°</span>
    legacy_ptr&lt;int&gt; unsafe_ptr = sp.leak_unsafe();
}</code></pre>
            </div>
            <p><strong>è¯­ä¹‰è§£é‡Šï¼š</strong></p>
            <ul>
                <li><code>safe{}</code>ï¼šå¯ç”¨ç¼–è¯‘æœŸå†…å­˜å®‰å…¨æ£€æŸ¥ï¼Œå¼ºåˆ¶ä½¿ç”¨æ‰€æœ‰æƒç³»ç»Ÿ</li>
                <li><code>legacy{}</code>ï¼šä¼ ç»ŸC++æ¨¡å¼ï¼Œä»…è¿è¡Œæ—¶åŸºç¡€æ£€æŸ¥</li>
                <li>è·¨åŸŸæŒ‡é’ˆä¼ é€’éœ€ä½¿ç”¨<code>legacy_ptr&lt;T&gt;</code>åŒ…è£…</li>
            </ul>
        </div>

        <div class="feature-card">
            <h3>æ‰€æœ‰æƒç³»ç»Ÿ</h3>
            <div class="code-block">
                <pre><code class="language-cpp"><span class="code-keyword">own</span>&lt;T&gt;</span>ï¼šç‹¬å æ‰€æœ‰æƒæŒ‡é’ˆ
<span class="code-keyword">shared</span>&lt;T&gt;</span>ï¼šå…±äº«æ‰€æœ‰æƒæŒ‡é’ˆ
<span class="code-keyword">borrow</span>&lt;T&gt;</span>ï¼šä¸å¯å˜å€Ÿç”¨
<span class="code-keyword">borrow mut</span>&lt;T&gt;</span>ï¼šå¯å˜å€Ÿç”¨

safe {
    <span class="code-keyword">own</span>&lt;Data&gt; d1 = own_new&lt;Data&gt;();
    <span class="code-keyword">own</span>&lt;Data&gt; d2 = move(d1);  // æ‰€æœ‰æƒè½¬ç§»
    
    <span class="code-keyword">borrow</span>&lt;Data&gt; view = *d2;  // åªè¯»å€Ÿç”¨
    <span class="code-keyword">borrow mut</span>&lt;Data&gt; mut_view = *d2;  // å¯å˜å€Ÿç”¨
    
    <span class="code-comment">// é”™è¯¯ç¤ºä¾‹ï¼šåŒæ—¶å­˜åœ¨å¯å˜å’Œä¸å¯å˜å€Ÿç”¨</span>
    <span class="code-comment">// borrow&lt;Data&gt; another_view = *d2;</span>
}</code></pre>
            </div>
            <p><strong>æ ¸å¿ƒè§„åˆ™ï¼š</strong></p>
            <ul>
                <li>ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å€Ÿç”¨æˆ–å¤šä¸ªä¸å¯å˜å€Ÿç”¨</li>
                <li>æ‰€æœ‰æƒè½¬ç§»ååŸæŒ‡é’ˆç«‹å³å¤±æ•ˆ</li>
                <li>å€Ÿç”¨ç”Ÿå‘½å‘¨æœŸä¸å¾—è¶…è¿‡æ‰€æœ‰è€…</li>
            </ul>
        </div>
    </section>

    <!-- å†…å­˜ç®¡ç† -->
    <section id="memory" class="section">
        <h2>ğŸ§  å†…å­˜æ¨¡å‹</h2>

        <div class="feature-card">
            <h3>æ··åˆåƒåœ¾å›æ”¶</h3>
            <div class="code-block">
                <pre><code class="language-cpp">// åˆ†ä»£GCï¼ˆé»˜è®¤æ¨¡å¼ï¼‰
gc {
    Gc&lt;Node&gt; node = gc_new&lt;Node&gt;();  // è‡ªåŠ¨ç®¡ç†
    node-&gt;link(other_node);
}

// æ‰‹åŠ¨ä¸GCæ··åˆç®¡ç†
safe {
    own&lt;Connection&gt; conn = own_new&lt;Connection&gt;();
    gc {
        Gc&lt;Session&gt; session = gc_adopt(conn.release());
    }
}</code></pre>
            </div>
            <p><strong>GCæ¨¡å¼ï¼š</strong></p>
            <table>
                <tr><th>æ¨¡å¼</th><th>å¯åŠ¨å‚æ•°</th><th>ç‰¹å¾</th></tr>
                <tr><td>åˆ†ä»£GC</td><td>--gc=generational</td><td>å¹´è½»ä»£/è€å¹´ä»£åˆ’åˆ†</td></tr>
                <tr><td>å¢é‡GC</td><td>--gc=incremental</td><td>ä½å»¶è¿Ÿå›æ”¶</td></tr>
                <tr><td>åŒºåŸŸGC</td><td>--gc=regional</td><td>å †å†…å­˜åˆ†åŒºç®¡ç†</td></tr>
            </table>
        </div>
    </section>

    <!-- å¹¶å‘æ¨¡å‹ -->
    <section id="concurrency" class="section">
        <h2>âš¡ å¹¶å‘æ¨¡å‹</h2>

        <div class="feature-card">
            <h3>ç»“æ„åŒ–å¹¶å‘</h3>
            <div class="code-block">
                <pre><code class="language-cpp">async scope {
    let task1 = co_spawn fetch_data("url1");
    let task2 = co_spawn process_stream();

    <span class="code-comment">// å®‰å…¨é€šé“</span>
    Chan&lt;int&gt; pipe(10);
    
    par {
        <span class="code-comment">// ç”Ÿäº§è€…</span>
        pipe.send(co_await task1);
        
        <span class="code-comment">// æ¶ˆè´¹è€…</span>
        if (let Some(data) = pipe.recv()) {
            process(data);
        }
    }

    <span class="code-comment">// æ˜¾å¼åˆå¹¶ç‚¹</span>
    -> merge(task1, task2) {
        log::info("æ‰€æœ‰ä»»åŠ¡å®Œæˆ");
    }
} <span class="code-comment">// è‡ªåŠ¨ç­‰å¾…å­ä»»åŠ¡</span></code></pre>
            </div>
            <p><strong>æ ¸å¿ƒç»„ä»¶ï¼š</strong></p>
            <ul>
                <li><code>async scope</code>ï¼šå®šä¹‰å¹¶å‘ä½œç”¨åŸŸ</li>
                <li><code>co_spawn</code>ï¼šå¯åŠ¨åç¨‹ä»»åŠ¡</li>
                <li><code>par</code>ï¼šå¹¶è¡Œæ‰§è¡Œå—</li>
                <li><code>Chan&lt;T&gt;</code>ï¼šå¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…é€šé“</li>
            </ul>
        </div>
    </section>

    <!-- é«˜çº§è¯­æ³• -->
    <section id="syntax" class="section">
        <h2>ğŸ”® é«˜çº§è¯­æ³•</h2>

        <div class="feature-card">
            <h3>æ¨¡å¼åŒ¹é…</h3>
            <div class="code-block">
                <pre><code class="language-cpp">enum Result&lt;T, E&gt; { Ok(T), Err(E) };

fn process(res: Result&lt;i32, String&gt;) {
    match (res) {
        Ok(var value) if value > 0 => {
            println!("æ­£å€¼: {}", value);
        }
        Ok(0..=100) => {
            println!("èŒƒå›´å€¼");
        }
        Err(var msg) => {
            log::error("é”™è¯¯: {}", msg);
        }
        _ => panic!("æœªå¤„ç†çš„æƒ…å†µ");
    }
}</code></pre>
            </div>
            <p><strong>åŒ¹é…æ¨¡å¼ï¼š</strong></p>
            <ul>
                <li>ç±»å‹åŒ¹é…ï¼š<code>Ok(var x)</code></li>
                <li>èŒƒå›´åŒ¹é…ï¼š<code>0..100</code></li>
                <li>æ¡ä»¶å®ˆå«ï¼š<code>if value > 0</code></li>
                <li>é€šé…ç¬¦ï¼š<code>_</code></li>
            </ul>
        </div>

        <div class="feature-card">
            <h3>å§”æ‰˜ä¸äº‹ä»¶</h3>
            <div class="code-block">
                <pre><code class="language-cpp">// ç±»å‹å®‰å…¨å§”æ‰˜
delegate void Logger(string msg);

// å¤šæ’­äº‹ä»¶
event ClickEvent = multicast&lt;Logger&gt;;

class Button {
    event ClickEvent clicked;
    
    void press() {
        clicked.invoke("æŒ‰é’®ç‚¹å‡»");
    }
}

// è®¢é˜…äº‹ä»¶
safe {
    Button btn;
    btn.clicked += [](string msg) {
        println!("äº‹ä»¶: {}", msg);
    };
}</code></pre>
            </div>
            <p><strong>äº‹ä»¶è§„åˆ™ï¼š</strong></p>
            <ul>
                <li>è‡ªåŠ¨ç®¡ç†è®¢é˜…è€…ç”Ÿå‘½å‘¨æœŸ</li>
                <li>çº¿ç¨‹å®‰å…¨çš„è°ƒç”¨æœºåˆ¶</li>
                <li>æ”¯æŒåç¨‹å¼‚æ­¥äº‹ä»¶</li>
            </ul>
        </div>
    </section>

    <!-- ç³»ç»Ÿç¼–ç¨‹ -->
    <section id="system" class="section">
        <h2>ğŸ–¥ï¸ ç³»ç»Ÿç¼–ç¨‹</h2>

        <div class="feature-card">
            <h3>å†…è”æ±‡ç¼–</h3>
            <div class="code-block">
                <pre><code class="language-cpp">[[naked]]
fn void syscall_entry() {
    asm!(
        "pusha",
        "mov eax, [esp+32]",
        "call cr_syscall_handler",
        "popa",
        "iret",
        options(noreturn)
}</code></pre>
            </div>
            <p><strong>åµŒå…¥è§„åˆ™ï¼š</strong></p>
            <ul>
                <li><code>[[naked]]</code>ï¼šç¦æ­¢ç¼–è¯‘å™¨ç”Ÿæˆé¢å¤–ä»£ç </li>
                <li><code>asm!</code>å®æ”¯æŒAT&amp;T/Intelè¯­æ³•</li>
                <li>å¿…é¡»æ˜¾å¼å£°æ˜å¯„å­˜å™¨ä½¿ç”¨</li>
            </ul>
        </div>
    </section>
</body>
</html>